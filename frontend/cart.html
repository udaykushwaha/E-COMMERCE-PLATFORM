<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Your Cart</title>
</head>
<body>
  <h2>Your Shopping Cart</h2>
  <div id="cartItems"></div>
  <button onclick="checkout()">Checkout</button>

  <script>
    async function fetchCart() {
      const token = localStorage.getItem("token");

      const res = await fetch("http://localhost:5000/api/cart", {
        method: "GET",
        headers: {
          "Authorization": `Bearer ${token}`
        }
      });

      const data = await res.json();

      const cartDiv = document.getElementById("cartItems");
      cartDiv.innerHTML = "";

      if (!data || !data.items || data.items.length === 0) {
        cartDiv.innerHTML = "<p>Your cart is empty.</p>";
        return;
      }

      data.items.forEach((item) => {
        const el = document.createElement("div");
        el.innerHTML = `
          <h3>${item.product.name}</h3>
          <p>Price: ₹${item.product.price}</p>
          <p>Quantity: ${item.quantity}</p>
          <hr/>
        `;
        cartDiv.appendChild(el);
      });
    }

    async function checkout() {
      const token = localStorage.getItem("token");

      const res = await fetch("http://localhost:5000/api/orders/checkout", {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${token}`
        }
      });

      const data = await res.json();

      if (res.status === 201) {
        alert("✅ Order placed successfully!");
        window.location.reload(); // refresh cart after checkout
      } else {
        alert(data.message || "Checkout failed.");
      }
    }

    fetchCart();
  </script>
</body>
</html>
